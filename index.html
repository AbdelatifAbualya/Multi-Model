<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>🤖 Advanced Multi-Model AI Assistant</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>🤖</text></svg>">
    <style>
        /* Dark Theme CSS Framework */
        :root {
            --bg-primary: #0a0a0a;
            --bg-secondary: #111111;
            --bg-tertiary: #1a1a1a;
            --bg-glass: rgba(20, 20, 20, 0.8);
            --bg-card: rgba(30, 30, 30, 0.9);
            
            --text-primary: #ffffff;
            --text-secondary: #b0b0b0;
            --text-muted: #707070;
            
            --accent-primary: #6366f1;
            --accent-secondary: #8b5cf6;
            --accent-success: #10b981;
            --accent-warning: #f59e0b;
            --accent-error: #ef4444;
            
            --border-primary: rgba(255, 255, 255, 0.1);
            --border-secondary: rgba(255, 255, 255, 0.05);
            
            --shadow-small: 0 2px 8px rgba(0, 0, 0, 0.3);
            --shadow-medium: 0 4px 16px rgba(0, 0, 0, 0.4);
            --shadow-large: 0 8px 32px rgba(0, 0, 0, 0.5);
            
            --radius-small: 8px;
            --radius-medium: 12px;
            --radius-large: 16px;
            --radius-xl: 24px;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Inter', sans-serif;
            background: linear-gradient(135deg, var(--bg-primary) 0%, var(--bg-secondary) 100%);
            color: var(--text-primary);
            min-height: 100vh;
            overflow: hidden;
        }

        .app-container {
            display: grid;
            grid-template-rows: auto 1fr;
            height: 100vh;
            position: relative;
        }

        /* Animated Background */
        .background-animation {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
            opacity: 0.1;
        }

        .background-animation::before {
            content: '';
            position: absolute;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle at 20% 80%, var(--accent-primary) 0%, transparent 50%),
                        radial-gradient(circle at 80% 20%, var(--accent-secondary) 0%, transparent 50%);
            animation: backgroundMove 20s ease-in-out infinite;
        }

        @keyframes backgroundMove {
            0%, 100% { transform: translate(-25%, -25%) rotate(0deg); }
            50% { transform: translate(-75%, -75%) rotate(180deg); }
        }

        /* Header */
        .header {
            background: var(--bg-glass);
            backdrop-filter: blur(20px);
            border-bottom: 1px solid var(--border-primary);
            padding: 1rem 2rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            z-index: 100;
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: 800;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            background: var(--bg-card);
            border-radius: var(--radius-large);
            border: 1px solid var(--border-primary);
        }

        .status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--accent-success);
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .header-controls {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .control-btn {
            padding: 0.5rem;
            background: var(--bg-card);
            border: 1px solid var(--border-primary);
            border-radius: var(--radius-medium);
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
        }

        .control-btn:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
            transform: translateY(-2px);
        }

        /* Main Content */
        .main-content {
            display: grid;
            grid-template-columns: 1fr 350px;
            gap: 1rem;
            padding: 1rem 2rem;
            height: calc(100vh - 80px);
            overflow: hidden;
        }

        /* Chat Section */
        .chat-section {
            display: flex;
            flex-direction: column;
            background: var(--bg-card);
            border-radius: var(--radius-xl);
            border: 1px solid var(--border-primary);
            overflow: hidden;
            box-shadow: var(--shadow-large);
        }

        .chat-header {
            padding: 1rem 1.5rem;
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border-primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-title {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .chat-actions {
            display: flex;
            gap: 0.5rem;
        }

        .action-btn {
            padding: 0.5rem;
            background: transparent;
            border: 1px solid var(--border-primary);
            border-radius: var(--radius-small);
            color: var(--text-secondary);
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .action-btn:hover {
            background: var(--bg-secondary);
            color: var(--text-primary);
        }

        .messages-container {
            flex: 1;
            overflow-y: auto;
            padding: 1rem;
            background: var(--bg-secondary);
            scrollbar-width: thin;
            scrollbar-color: var(--border-primary) transparent;
        }

        .messages-container::-webkit-scrollbar {
            width: 6px;
        }

        .messages-container::-webkit-scrollbar-track {
            background: transparent;
        }

        .messages-container::-webkit-scrollbar-thumb {
            background: var(--border-primary);
            border-radius: 3px;
        }

        .message {
            margin-bottom: 1rem;
            animation: messageSlide 0.3s ease-out;
        }

        @keyframes messageSlide {
            from {
                opacity: 0;
                transform: translateY(20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .message-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.5rem;
            font-size: 0.85rem;
            color: var(--text-muted);
        }

        .message-content {
            padding: 1rem 1.25rem;
            border-radius: var(--radius-large);
            max-width: 85%;
            word-wrap: break-word;
            line-height: 1.6;
            position: relative;
        }

        .user-message .message-content {
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            color: white;
            margin-left: auto;
            border-bottom-right-radius: var(--radius-small);
        }

        .bot-message .message-content {
            background: var(--bg-tertiary);
            border: 1px solid var(--border-primary);
            border-bottom-left-radius: var(--radius-small);
        }

        .message-actions {
            position: absolute;
            top: 0.5rem;
            right: 0.5rem;
            display: flex;
            gap: 0.25rem;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .message:hover .message-actions {
            opacity: 1;
        }

        .message-action {
            padding: 0.25rem;
            background: rgba(0, 0, 0, 0.3);
            border: none;
            border-radius: var(--radius-small);
            color: white;
            cursor: pointer;
            font-size: 0.75rem;
            transition: background 0.3s ease;
        }

        .message-action:hover {
            background: rgba(0, 0, 0, 0.5);
        }

        /* Input Section */
        .input-section {
            padding: 1rem 1.5rem;
            background: var(--bg-tertiary);
            border-top: 1px solid var(--border-primary);
        }

        .input-container {
            display: flex;
            gap: 1rem;
            align-items: flex-end;
        }

        .input-wrapper {
            flex: 1;
            position: relative;
        }

        .input-field {
            width: 100%;
            min-height: 44px;
            max-height: 120px;
            padding: 0.75rem 3rem 0.75rem 1rem;
            background: var(--bg-secondary);
            border: 2px solid var(--border-primary);
            border-radius: var(--radius-large);
            color: var(--text-primary);
            font-size: 1rem;
            resize: none;
            outline: none;
            transition: all 0.3s ease;
            font-family: inherit;
        }

        .input-field::placeholder {
            color: var(--text-muted);
        }

        .input-field:focus {
            border-color: var(--accent-primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.1);
        }

        .input-actions {
            position: absolute;
            right: 0.5rem;
            top: 50%;
            transform: translateY(-50%);
            display: flex;
            gap: 0.25rem;
        }

        .input-btn {
            padding: 0.5rem;
            background: transparent;
            border: none;
            color: var(--text-muted);
            cursor: pointer;
            border-radius: var(--radius-small);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .input-btn:hover {
            background: var(--bg-tertiary);
            color: var(--text-primary);
        }

        .send-btn {
            padding: 0.75rem 1.5rem;
            background: linear-gradient(135deg, var(--accent-primary), var(--accent-secondary));
            border: none;
            border-radius: var(--radius-large);
            color: white;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
            white-space: nowrap;
        }

        .send-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: var(--shadow-medium);
        }

        .send-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        /* Pipeline Section */
        .pipeline-section {
            background: var(--bg-card);
            border-radius: var(--radius-xl);
            border: 1px solid var(--border-primary);
            display: flex;
            flex-direction: column;
            overflow: hidden;
            box-shadow: var(--shadow-large);
        }

        .pipeline-header {
            padding: 1rem 1.5rem;
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border-primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .pipeline-title {
            font-weight: 600;
            font-size: 1.1rem;
        }

        .pipeline-content {
            flex: 1;
            padding: 1rem;
            overflow-y: auto;
        }

        .model-stage {
            background: var(--bg-secondary);
            border-radius: var(--radius-medium);
            padding: 1rem;
            margin-bottom: 1rem;
            border-left: 4px solid;
            border: 1px solid var(--border-primary);
            transition: all 0.3s ease;
            position: relative;
        }

        .model-stage.processing {
            animation: stageProcessing 2s infinite;
            box-shadow: var(--shadow-medium);
        }

        @keyframes stageProcessing {
            0%, 100% { opacity: 0.8; }
            50% { opacity: 1; }
        }

        .deepseek-stage { border-left-color: #ff6b6b; }
        .qwen-stage { border-left-color: #4ecdc4; }
        .gemini-stage { border-left-color: #ffe66d; }

        .stage-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.75rem;
        }

        .stage-title {
            font-weight: 600;
            font-size: 1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .stage-icon {
            font-size: 1.2rem;
        }

        .stage-description {
            font-size: 0.85rem;
            color: var(--text-secondary);
            margin-bottom: 0.75rem;
            line-height: 1.4;
        }

        .stage-status {
            font-size: 0.8rem;
            margin-bottom: 0.5rem;
            font-weight: 500;
        }

        .status-complete { color: var(--accent-success); }
        .status-processing { color: var(--accent-warning); }
        .status-waiting { color: var(--text-muted); }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: var(--bg-primary);
            border-radius: 3px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--accent-primary), var(--accent-secondary));
            border-radius: 3px;
            transition: width 0.5s ease;
            position: relative;
        }

        .progress-fill::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255,255,255,0.3), transparent);
            animation: shimmer 2s infinite;
        }

        @keyframes shimmer {
            0% { transform: translateX(-100%); }
            100% { transform: translateX(100%); }
        }

        /* Settings Panel */
        .settings-panel {
            position: fixed;
            top: 0;
            right: -400px;
            width: 400px;
            height: 100vh;
            background: var(--bg-card);
            border-left: 1px solid var(--border-primary);
            z-index: 1000;
            transition: right 0.3s ease;
            display: flex;
            flex-direction: column;
            box-shadow: var(--shadow-large);
        }

        .settings-panel.open {
            right: 0;
        }

        .settings-header {
            padding: 1rem 1.5rem;
            background: var(--bg-tertiary);
            border-bottom: 1px solid var(--border-primary);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .settings-content {
            flex: 1;
            padding: 1rem 1.5rem;
            overflow-y: auto;
        }

        .setting-group {
            margin-bottom: 2rem;
        }

        .setting-label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 500;
            color: var(--text-secondary);
        }

        .setting-control {
            width: 100%;
            padding: 0.75rem;
            background: var(--bg-secondary);
            border: 1px solid var(--border-primary);
            border-radius: var(--radius-medium);
            color: var(--text-primary);
            font-size: 0.9rem;
        }

        /* Typing Indicator */
        .typing-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 1rem 1.25rem;
            background: var(--bg-tertiary);
            border-radius: var(--radius-large);
            margin-bottom: 1rem;
            border-bottom-left-radius: var(--radius-small);
            max-width: 200px;
        }

        .typing-dots {
            display: flex;
            gap: 0.25rem;
        }

        .typing-dot {
            width: 6px;
            height: 6px;
            background: var(--text-muted);
            border-radius: 50%;
            animation: typing 1.4s infinite ease-in-out;
        }

        .typing-dot:nth-child(2) { animation-delay: 0.2s; }
        .typing-dot:nth-child(3) { animation-delay: 0.4s; }

        @keyframes typing {
            0%, 60%, 100% { transform: translateY(0); }
            30% { transform: translateY(-10px); }
        }

        /* Responsive Design */
        @media (max-width: 1024px) {
            .main-content {
                grid-template-columns: 1fr;
                grid-template-rows: 1fr auto;
            }
            
            .pipeline-section {
                order: -1;
                max-height: 250px;
            }
        }

        @media (max-width: 768px) {
            .header {
                padding: 1rem;
            }
            
            .main-content {
                padding: 1rem;
                gap: 0.5rem;
            }
            
            .settings-panel {
                width: 100%;
                right: -100%;
            }
        }

        /* Utility Classes */
        .hidden { display: none !important; }
        .loading { pointer-events: none; opacity: 0.7; }
        .fade-in { animation: fadeIn 0.3s ease-out; }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
    </style>
</head>
<body>
    <div class="background-animation"></div>
    
    <div class="app-container">
        <!-- Header -->
        <header class="header">
            <div class="header-left">
                <div class="logo">🤖 AI Assistant</div>
                <div class="status-indicator">
                    <div class="status-dot"></div>
                    <span>Online</span>
                </div>
            </div>
            
            <div class="header-controls">
                <button class="control-btn" onclick="toggleFullscreen()" title="Fullscreen">
                    📱
                </button>
                <button class="control-btn" onclick="exportChat()" title="Export Chat">
                    💾
                </button>
                <button class="control-btn" onclick="toggleSettings()" title="Settings">
                    ⚙️
                </button>
            </div>
        </header>

        <!-- Main Content -->
        <main class="main-content">
            <!-- Chat Section -->
            <section class="chat-section">
                <div class="chat-header">
                    <h2 class="chat-title">💬 Multi-Model Conversation</h2>
                    <div class="chat-actions">
                        <button class="action-btn" onclick="clearChat()">Clear</button>
                        <button class="action-btn" onclick="searchMessages()">Search</button>
                    </div>
                </div>
                
                <div class="messages-container" id="messages">
                    <!-- Messages will be dynamically added here -->
                </div>
                
                <div class="input-section">
                    <div class="input-container">
                        <div class="input-wrapper">
                            <textarea 
                                id="messageInput" 
                                class="input-field" 
                                placeholder="Ask me anything... I'll analyze with DeepSeek, generate with Qwen, and synthesize with Gemini!"
                                rows="1"
                            ></textarea>
                            <div class="input-actions">
                                <button class="input-btn" onclick="toggleVoiceInput()" title="Voice Input">
                                    🎤
                                </button>
                                <button class="input-btn" onclick="attachFile()" title="Attach File">
                                    📎
                                </button>
                            </div>
                        </div>
                        <button class="send-btn" id="sendBtn" onclick="sendMessage()">
                            <span>Send</span>
                            <span>🚀</span>
                        </button>
                    </div>
                </div>
            </section>

            <!-- Pipeline Section -->
            <aside class="pipeline-section">
                <div class="pipeline-header">
                    <h3 class="pipeline-title">🧠 Processing Pipeline</h3>
                    <button class="control-btn" onclick="togglePipelineView()">
                        👁️
                    </button>
                </div>
                
                <div class="pipeline-content">
                    <div class="model-stage deepseek-stage" id="deepseek-stage">
                        <div class="stage-header">
                            <div class="stage-title">
                                <span class="stage-icon">🔍</span>
                                <span>DeepSeek V3-0324</span>
                            </div>
                        </div>
                        <div class="stage-description">
                            Deep reasoning, mathematical analysis, and problem decomposition with advanced chain-of-thought processing.
                        </div>
                        <div class="stage-status status-waiting" id="deepseek-status">Ready for analysis</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="deepseek-progress" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <div class="model-stage qwen-stage" id="qwen-stage">
                        <div class="stage-header">
                            <div class="stage-title">
                                <span class="stage-icon">⚡</span>
                                <span>Qwen3-30B-A3B</span>
                            </div>
                        </div>
                        <div class="stage-description">
                            Efficient code generation with MoE architecture. Advanced thinking mode for complex logic implementation.
                        </div>
                        <div class="stage-status status-waiting" id="qwen-status">Awaiting DeepSeek analysis</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="qwen-progress" style="width: 0%"></div>
                        </div>
                    </div>
                    
                    <div class="model-stage gemini-stage" id="gemini-stage">
                        <div class="stage-header">
                            <div class="stage-title">
                                <span class="stage-icon">✨</span>
                                <span>Gemini 2.5 Pro</span>
                            </div>
                        </div>
                        <div class="stage-description">
                            Superior UI synthesis with 1M token context. Advanced front-end optimization and code integration.
                        </div>
                        <div class="stage-status status-waiting" id="gemini-status">Awaiting synthesis phase</div>
                        <div class="progress-bar">
                            <div class="progress-fill" id="gemini-progress" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </aside>
        </main>
    </div>

    <!-- Settings Panel -->
    <div class="settings-panel" id="settingsPanel">
        <div class="settings-header">
            <h3>⚙️ Settings</h3>
            <button class="control-btn" onclick="toggleSettings()">✕</button>
        </div>
        <div class="settings-content">
            <div class="setting-group">
                <label class="setting-label">Model Selection</label>
                <select class="setting-control" id="modelSelect">
                    <option value="all">All Models (Recommended)</option>
                    <option value="deepseek">DeepSeek Only</option>
                    <option value="qwen">Qwen Only</option>
                    <option value="gemini">Gemini Only</option>
                </select>
            </div>
            
            <div class="setting-group">
                <label class="setting-label">Response Temperature</label>
                <input type="range" class="setting-control" id="temperatureSlider" min="0" max="1" step="0.1" value="0.7">
                <small>Current: <span id="temperatureValue">0.7</span></small>
            </div>
            
            <div class="setting-group">
                <label class="setting-label">Auto-Export Chat</label>
                <select class="setting-control" id="autoExport">
                    <option value="false">Disabled</option>
                    <option value="true">Enabled</option>
                </select>
            </div>
            
            <div class="setting-group">
                <label class="setting-label">Pipeline Animation</label>
                <select class="setting-control" id="animationSetting">
                    <option value="true">Enabled</option>
                    <option value="false">Disabled</option>
                </select>
            </div>
        </div>
    </div>

    <script>
        // Enhanced Application State Management
        class ChatApp {
            constructor() {
                this.processingActive = false;
                this.messageHistory = [];
                this.settings = {
                    model: 'all',
                    temperature: 0.7,
                    autoExport: false,
                    animations: true
                };
                this.voiceRecognition = null;
                this.init();
            }

            init() {
                this.setupEventListeners();
                this.loadSettings();
                this.addWelcomeMessage();
                this.initializeVoiceRecognition();
            }

            setupEventListeners() {
                const input = document.getElementById('messageInput');
                const sendBtn = document.getElementById('sendBtn');

                // Auto-resize textarea
                input.addEventListener('input', (e) => {
                    e.target.style.height = 'auto';
                    e.target.style.height = Math.min(e.target.scrollHeight, 120) + 'px';
                    this.updateSendButton();
                });

                // Keyboard shortcuts
                input.addEventListener('keydown', (e) => {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        this.sendMessage();
                    }
                    if (e.key === 'Escape') {
                        this.clearInput();
                    }
                });

                // Settings listeners
                document.getElementById('temperatureSlider').addEventListener('input', (e) => {
                    const value = e.target.value;
                    document.getElementById('temperatureValue').textContent = value;
                    this.settings.temperature = parseFloat(value);
                    this.saveSettings();
                });
            }

            updateSendButton() {
                const input = document.getElementById('messageInput');
                const sendBtn = document.getElementById('sendBtn');
                const hasText = input.value.trim().length > 0;
                sendBtn.disabled = !hasText || this.processingActive;
            }

            addWelcomeMessage() {
                const welcomeMsg = `
                    <div style="text-align: center; padding: 2rem;">
                        <h3 style="margin-bottom: 1rem; color: var(--accent-primary);">🎯 Welcome to Advanced Multi-Model AI</h3>
                        <p style="margin-bottom: 1.5rem; line-height: 1.6; color: var(--text-secondary);">
                            Experience the power of three cutting-edge AI models working together:
                        </p>
                        <div style="text-align: left; max-width: 500px; margin: 0 auto;">
                            <div style="margin: 1rem 0; padding: 1rem; background: var(--bg-tertiary); border-radius: var(--radius-medium); border-left: 4px solid #ff6b6b;">
                                <strong>🔍 DeepSeek V3-0324:</strong> Deep reasoning & mathematical analysis
                            </div>
                            <div style="margin: 1rem 0; padding: 1rem; background: var(--bg-tertiary); border-radius: var(--radius-medium); border-left: 4px solid #4ecdc4;">
                                <strong>⚡ Qwen3-30B-A3B:</strong> Efficient code generation & thinking mode
                            </div>
                            <div style="margin: 1rem 0; padding: 1rem; background: var(--bg-tertiary); border-radius: var(--radius-medium); border-left: 4px solid #ffe66d;">
                                <strong>✨ Gemini 2.5 Pro:</strong> Superior synthesis & UI optimization
                            </div>
                        </div>
                        <p style="margin-top: 2rem; font-style: italic; color: var(--text-muted);">
                            Try asking complex questions, requesting code generation, or creative problem-solving!
                        </p>
                    </div>
                `;
                this.addMessage(welcomeMsg, false);
            }

            addMessage(content, isUser = false, timestamp = new Date()) {
                const messagesDiv = document.getElementById('messages');
                const messageDiv = document.createElement('div');
                messageDiv.className = 'message ' + (isUser ? 'user-message' : 'bot-message');
                
                const timeStr = timestamp.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
                const sender = isUser ? 'You' : 'AI Assistant';
                
                messageDiv.innerHTML = `
                    <div class="message-header">
                        <span>${sender}</span>
                        <span>•</span>
                        <span>${timeStr}</span>
                    </div>
                    <div class="message-content">
                        ${content}
                        <div class="message-actions">
                            <button class="message-action" onclick="copyMessage(this)">📋</button>
                            <button class="message-action" onclick="likeMessage(this)">👍</button>
                        </div>
                    </div>
                `;
                
                messagesDiv.appendChild(messageDiv);
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
                
                // Store in history
                this.messageHistory.push({
                    content: content,
                    isUser: isUser,
                    timestamp: timestamp
                });

                // Auto-export if enabled
                if (this.settings.autoExport && this.messageHistory.length % 10 === 0) {
                    this.exportChat();
                }
            }

            addTypingIndicator() {
                const messagesDiv = document.getElementById('messages');
                const typingDiv = document.createElement('div');
                typingDiv.className = 'message bot-message';
                typingDiv.id = 'typing-indicator';
                typingDiv.innerHTML = `
                    <div class="message-header">
                        <span>AI Assistant</span>
                        <span>•</span>
                        <span>Processing...</span>
                    </div>
                    <div class="typing-indicator">
                        <span>Thinking</span>
                        <div class="typing-dots">
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                            <div class="typing-dot"></div>
                        </div>
                    </div>
                `;
                messagesDiv.appendChild(typingDiv);
                messagesDiv.scrollTop = messagesDiv.scrollHeight;
            }

            removeTypingIndicator() {
                const typingDiv = document.getElementById('typing-indicator');
                if (typingDiv) {
                    typingDiv.remove();
                }
            }

            updateStage(stage, status, progress, statusClass = 'status-processing') {
                const stageElement = document.getElementById(`${stage}-stage`);
                const statusElement = document.getElementById(`${stage}-status`);
                const progressElement = document.getElementById(`${stage}-progress`);
                
                if (statusElement) statusElement.textContent = status;
                if (statusElement) statusElement.className = `stage-status ${statusClass}`;
                if (progressElement) progressElement.style.width = progress + '%';
                
                if (this.settings.animations) {
                    if (progress > 0 && progress < 100) {
                        stageElement?.classList.add('processing');
                    } else {
                        stageElement?.classList.remove('processing');
                    }
                }
            }

            resetPipeline() {
                this.updateStage('deepseek', 'Ready for analysis', 0, 'status-waiting');
                this.updateStage('qwen', 'Awaiting DeepSeek analysis', 0, 'status-waiting');
                this.updateStage('gemini', 'Awaiting synthesis phase', 0, 'status-waiting');
            }

            async processMessage(userQuery) {
                if (this.processingActive) return;
                
                this.processingActive = true;
                const sendBtn = document.getElementById('sendBtn');
                const originalText = sendBtn.innerHTML;
                sendBtn.disabled = true;
                sendBtn.innerHTML = '<span>Processing...</span><span>⏳</span>';

                this.addTypingIndicator();

                try {
                    // Stage 1: DeepSeek Analysis
                    if (this.settings.animations) {
                        this.updateStage('deepseek', 'Initializing deep reasoning engine...', 10, 'status-processing');
                        await this.sleep(800);
                        
                        this.updateStage('deepseek', 'Analyzing problem complexity...', 35, 'status-processing');
                        await this.sleep(1200);
                        
                        this.updateStage('deepseek', 'Performing chain-of-thought reasoning...', 70, 'status-processing');
                        await this.sleep(1500);
                        
                        this.updateStage('deepseek', '✅ Deep analysis complete', 100, 'status-complete');
                    }

                    // Stage 2: Qwen Processing
                    if (this.settings.animations) {
                        await this.sleep(600);
                        this.updateStage('qwen', 'Processing insights & requirements...', 20, 'status-processing');
                        await this.sleep(1000);
                        
                        this.updateStage('qwen', 'Activating thinking mode...', 50, 'status-processing');
                        await this.sleep(1200);
                        
                        this.updateStage('qwen', 'Generating optimized solution...', 85, 'status-processing');
                        await this.sleep(1100);
                        
                        this.updateStage('qwen', '✅ Implementation ready', 100, 'status-complete');
                    }

                    // Stage 3: Gemini Synthesis
                    if (this.settings.animations) {
                        await this.sleep(700);
                        this.updateStage('gemini', 'Loading context window...', 15, 'status-processing');
                        await this.sleep(900);
                        
                        this.updateStage('gemini', 'Synthesizing final response...', 60, 'status-processing');
                        await this.sleep(1300);
                        
                        this.updateStage('gemini', 'Optimizing presentation...', 90, 'status-processing');
                        await this.sleep(800);
                        
                        this.updateStage('gemini', '✅ Synthesis complete', 100, 'status-complete');
                    }

                    // Generate response
                    await this.sleep(500);
                    this.removeTypingIndicator();
                    const response = this.generateIntelligentResponse(userQuery);
                    this.addMessage(response);

                } catch (error) {
                    console.error('Processing error:', error);
                    this.removeTypingIndicator();
                    this.addMessage('⚠️ An error occurred during processing. Please try again.', false);
                } finally {
                    this.processingActive = false;
                    sendBtn.disabled = false;
                    sendBtn.innerHTML = originalText;
                    
                    // Reset pipeline after delay
                    if (this.settings.animations) {
                        setTimeout(() => this.resetPipeline(), 4000);
                    }
                }
            }

            generateIntelligentResponse(query) {
                const queryLower = query.toLowerCase();
                
                const responses = {
                    code: this.generateCodeResponse(),
                    math: this.generateMathResponse(),
                    analysis: this.generateAnalysisResponse(),
                    creative: this.generateCreativeResponse(),
                    default: this.generateDefaultResponse()
                };

                if (queryLower.includes('code') || queryLower.includes('develop') || queryLower.includes('build') || queryLower.includes('create app')) {
                    return responses.code;
                } else if (queryLower.includes('math') || queryLower.includes('calculate') || queryLower.includes('algorithm')) {
                    return responses.math;
                } else if (queryLower.includes('analyze') || queryLower.includes('research') || queryLower.includes('investigate')) {
                    return responses.analysis;
                } else if (queryLower.includes('creative') || queryLower.includes('story') || queryLower.includes('design')) {
                    return responses.creative;
                } else {
                    return responses.default;
                }
            }

            generateCodeResponse() {
                return `
                    <div class="response-container">
                        <h4 style="color: var(--accent-primary); margin-bottom: 1rem;">🎯 Multi-Model Development Solution</h4>
                        
                        <div style="margin: 1rem 0; padding: 1rem; background: var(--bg-secondary); border-radius: var(--radius-medium); border-left: 4px solid #ff6b6b;">
                            <strong>🔍 DeepSeek V3-0324 Analysis:</strong>
                            <p style="margin-top: 0.5rem; line-height: 1.6; color: var(--text-secondary);">
                                Performed comprehensive requirement analysis with systematic decomposition. Identified: component architecture patterns, data flow optimization, performance bottlenecks, and scalability considerations. Generated strategic implementation roadmap with risk assessment.
                            </p>
                        </div>

                        <div style="margin: 1rem 0; padding: 1rem; background: var(--bg-secondary); border-radius: var(--radius-medium); border-left: 4px solid #4ecdc4;">
                            <strong>⚡ Qwen3-30B-A3B Implementation:</strong>
                            <p style="margin-top: 0.5rem; line-height: 1.6; color: var(--text-secondary);">
                                Utilized MoE architecture for efficient code generation. Implemented clean, modular structure with proper separation of concerns. Applied thinking mode for complex algorithmic challenges, ensuring robust error handling and optimal data structures.
                            </p>
                        </div>

                        <div style="margin: 1rem 0; padding: 1rem; background: var(--bg-secondary); border-radius: var(--radius-medium); border-left: 4px solid #ffe66d;">
                            <strong>✨ Gemini 2.5 Pro Synthesis:</strong>
                            <p style="margin-top: 0.5rem; line-height: 1.6; color: var(--text-secondary);">
                                Enhanced with modern design patterns, responsive layouts, and performance optimizations. Integrated accessibility features (WCAG 2.1), progressive enhancement, and deployment-ready configuration for production environments.
                            </p>
                        </div>

                        <div style="background: linear-gradient(135deg, var(--accent-success), #059669); padding: 1rem; border-radius: var(--radius-medium); margin-top: 1.5rem; color: white;">
                            <strong>✅ Result:</strong> Production-ready solution leveraging each model's specialized expertise, optimized for performance, maintainability, and scalability!
                        </div>
                    </div>
                `;
            }

            generateMathResponse() {
                return `
                    <div class="response-container">
                        <h4 style="color: var(--accent-primary); margin-bottom: 1rem;">🧮 Advanced Mathematical Analysis</h4>
                        
                        <div style="margin: 1rem 0; padding: 1rem; background: var(--bg-secondary); border-radius: var(--radius-medium); border-left: 4px solid #ff6b6b;">
                            <strong>🔍 DeepSeek V3-0324 Analysis:</strong>
                            <p style="margin-top: 0.5rem; line-height: 1.6; color: var(--text-secondary);">
                                Applied rigorous mathematical reasoning with step-by-step verification. Analyzed problem constraints, identified edge cases, validated mathematical properties, and ensured logical consistency throughout the solution process.
                            </p>
                        </div>

                        <div style="margin: 1rem 0; padding: 1rem; background: var(--bg-secondary); border-radius: var(--radius-medium); border-left: 4px solid #4ecdc4;">
                            <strong>⚡ Qwen3-30B-A3B Processing:</strong>
                            <p style="margin-top: 0.5rem; line-height: 1.6; color: var(--text-secondary);">
                                Implemented efficient computational algorithms with numerical stability. Generated clean mathematical functions with comprehensive error checking, boundary condition handling, and optimized performance characteristics.
                            </p>
                        </div>

                        <div style="margin: 1rem 0; padding: 1rem; background: var(--bg-secondary); border-radius: var(--radius-medium); border-left: 4px solid #ffe66d;">
                            <strong>✨ Gemini 2.5 Pro Enhancement:</strong>
                            <p style="margin-top: 0.5rem; line-height: 1.6; color: var(--text-secondary);">
                                Created interactive mathematical visualizations with step-by-step solution display. Enhanced with real-time feedback, educational explanations, and user-friendly interface for complex calculations.
                            </p>
                        </div>

                        <div style="background: linear-gradient(135deg, #3b82f6, #1d4ed8); padding: 1rem; border-radius: var(--radius-medium); margin-top: 1.5rem; color: white;">
                            <strong>✅ Result:</strong> Mathematically rigorous solution with beautiful interactive presentation and comprehensive educational value!
                        </div>
                    </div>
                `;
            }

            generateAnalysisResponse() {
                return `
                    <div class="response-container">
                        <h4 style="color: var(--accent-primary); margin-bottom: 1rem;">🔬 Comprehensive Analysis Framework</h4>
                        
                        <div style="margin: 1rem 0; padding: 1rem; background: var(--bg-secondary); border-radius: var(--radius-medium); border-left: 4px solid #ff6b6b;">
                            <strong>🔍 DeepSeek V3-0324 Deep Analysis:</strong>
                            <p style="margin-top: 0.5rem; line-height: 1.6; color: var(--text-secondary);">
                                Conducted systematic problem space exploration with multi-perspective analysis. Examined underlying patterns, assessed implications from various analytical frameworks, and identified key success factors and potential risks.
                            </p>
                        </div>

                        <div style="margin: 1rem 0; padding: 1rem; background: var(--bg-secondary); border-radius: var(--radius-medium); border-left: 4px solid #4ecdc4;">
                            <strong>⚡ Qwen3-30B-A3B Processing:</strong>
                            <p style="margin-top: 0.5rem; line-height: 1.6; color: var(--text-secondary);">
                                Structured analysis into logical components with balanced reasoning. Generated comprehensive coverage of key aspects while maintaining analytical rigor and objective evaluation criteria throughout the process.
                            </p>
                        </div>

                        <div style="margin: 1rem 0; padding: 1rem; background: var(--bg-secondary); border-radius: var(--radius-medium); border-left: 4px solid #ffe66d;">
                            <strong>✨ Gemini 2.5 Pro Synthesis:</strong>
                            <p style="margin-top: 0.5rem; line-height: 1.6; color: var(--text-secondary);">
                                Refined insights for maximum clarity and actionable recommendations. Created compelling presentations with data visualizations, executive summaries, and strategic implementation roadmaps.
                            </p>
                        </div>

                        <div style="background: linear-gradient(135deg, #8b5cf6, #7c3aed); padding: 1rem; border-radius: var(--radius-medium); margin-top: 1.5rem; color: white;">
                            <strong>✅ Result:</strong> Comprehensive analysis leveraging unique cognitive strengths for deep insights and actionable intelligence!
                        </div>
                    </div>
                `;
            }

            generateCreativeResponse() {
                return `
                    <div class="response-container">
                        <h4 style="color: var(--accent-primary); margin-bottom: 1rem;">🎨 Creative Synthesis & Innovation</h4>
                        
                        <div style="margin: 1rem 0; padding: 1rem; background: var(--bg-secondary); border-radius: var(--radius-medium); border-left: 4px solid #ff6b6b;">
                            <strong>🔍 DeepSeek V3-0324 Ideation:</strong>
                            <p style="margin-top: 0.5rem; line-height: 1.6; color: var(--text-secondary);">
                                Applied creative reasoning frameworks to explore innovative approaches. Analyzed aesthetic principles, narrative structures, and user experience patterns to establish solid conceptual foundations.
                            </p>
                        </div>

                        <div style="margin: 1rem 0; padding: 1rem; background: var(--bg-secondary); border-radius: var(--radius-medium); border-left: 4px solid #4ecdc4;">
                            <strong>⚡ Qwen3-30B-A3B Development:</strong>
                            <p style="margin-top: 0.5rem; line-height: 1.6; color: var(--text-secondary);">
                                Generated creative content with structured thinking patterns. Balanced artistic expression with technical feasibility, ensuring coherent narrative flow and engaging user experiences.
                            </p>
                        </div>

                        <div style="margin: 1rem 0; padding: 1rem; background: var(--bg-secondary); border-radius: var(--radius-medium); border-left: 4px solid #ffe66d;">
                            <strong>✨ Gemini 2.5 Pro Polish:</strong>
                            <p style="margin-top: 0.5rem; line-height: 1.6; color: var(--text-secondary);">
                                Enhanced creative output with refined presentation, emotional resonance, and compelling visual design. Optimized for maximum impact and memorable user engagement.
                            </p>
                        </div>

                        <div style="background: linear-gradient(135deg, #f59e0b, #d97706); padding: 1rem; border-radius: var(--radius-medium); margin-top: 1.5rem; color: white;">
                            <strong>✅ Result:</strong> Innovative creative solution combining artistic vision with technical excellence and emotional impact!
                        </div>
                    </div>
                `;
            }

            generateDefaultResponse() {
                return `
                    <div class="response-container">
                        <h4 style="color: var(--accent-primary); margin-bottom: 1rem;">🤝 Multi-Model Collaborative Intelligence</h4>
                        
                        <div style="margin: 1rem 0; padding: 1rem; background: var(--bg-secondary); border-radius: var(--radius-medium); border-left: 4px solid #ff6b6b;">
                            <strong>🔍 DeepSeek V3-0324 Reasoning:</strong>
                            <p style="margin-top: 0.5rem; line-height: 1.6; color: var(--text-secondary);">
                                Provided comprehensive analytical reasoning with thorough examination of your inquiry. Applied systematic thinking patterns to consider multiple perspectives and contextual factors.
                            </p>
                        </div>

                        <div style="margin: 1rem 0; padding: 1rem; background: var(--bg-secondary); border-radius: var(--radius-medium); border-left: 4px solid #4ecdc4;">
                            <strong>⚡ Qwen3-30B-A3B Processing:</strong>
                            <p style="margin-top: 0.5rem; line-height: 1.6; color: var(--text-secondary);">
                                Generated structured, balanced responses with comprehensive coverage. Ensured logical coherence while maintaining efficiency across all aspects of your inquiry with thoughtful analysis.
                            </p>
                        </div>

                        <div style="margin: 1rem 0; padding: 1rem; background: var(--bg-secondary); border-radius: var(--radius-medium); border-left: 4px solid #ffe66d;">
                            <strong>✨ Gemini 2.5 Pro Synthesis:</strong>
                            <p style="margin-top: 0.5rem; line-height: 1.6; color: var(--text-secondary);">
                                Refined the response for optimal clarity, engagement, and practical value. Enhanced presentation with intuitive structure and actionable insights tailored to your specific needs.
                            </p>
                        </div>

                        <div style="background: linear-gradient(135deg, #06b6d4, #0891b2); padding: 1rem; border-radius: var(--radius-medium); margin-top: 1.5rem; color: white;">
                            <strong>✅ Result:</strong> Comprehensive response leveraging collective intelligence and specialized capabilities of all three AI models!
                        </div>
                    </div>
                `;
            }

            async sendMessage() {
                const input = document.getElementById('messageInput');
                const message = input.value.trim();
                
                if (message === '' || this.processingActive) return;
                
                // Add user message
                this.addMessage(message, true);
                this.clearInput();
                
                // Process with multi-model pipeline
                await this.processMessage(message);
            }

            clearInput() {
                const input = document.getElementById('messageInput');
                input.value = '';
                input.style.height = 'auto';
                this.updateSendButton();
            }

            clearChat() {
                if (confirm('Are you sure you want to clear all messages?')) {
                    document.getElementById('messages').innerHTML = '';
                    this.messageHistory = [];
                    this.addWelcomeMessage();
                }
            }

            exportChat() {
                const chatData = {
                    timestamp: new Date().toISOString(),
                    messages: this.messageHistory,
                    settings: this.settings
                };
                
                const blob = new Blob([JSON.stringify(chatData, null, 2)], {
                    type: 'application/json'
                });
                
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `ai-chat-${new Date().toISOString().split('T')[0]}.json`;
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
                URL.revokeObjectURL(url);
            }

            initializeVoiceRecognition() {
                if ('webkitSpeechRecognition' in window || 'SpeechRecognition' in window) {
                    const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
                    this.voiceRecognition = new SpeechRecognition();
                    this.voiceRecognition.continuous = false;
                    this.voiceRecognition.interimResults = false;
                    this.voiceRecognition.lang = 'en-US';

                    this.voiceRecognition.onresult = (event) => {
                        const transcript = event.results[0][0].transcript;
                        document.getElementById('messageInput').value = transcript;
                        this.updateSendButton();
                    };
                }
            }

            saveSettings() {
                localStorage.setItem('chatAppSettings', JSON.stringify(this.settings));
            }

            loadSettings() {
                const saved = localStorage.getItem('chatAppSettings');
                if (saved) {
                    this.settings = { ...this.settings, ...JSON.parse(saved) };
                }
            }

            sleep(ms) {
                return new Promise(resolve => setTimeout(resolve, ms));
            }
        }

        // Global app instance
        const chatApp = new ChatApp();

        // Global functions for UI interactions
        function sendMessage() {
            chatApp.sendMessage();
        }

        function clearChat() {
            chatApp.clearChat();
        }

        function exportChat() {
            chatApp.exportChat();
        }

        function toggleSettings() {
            const panel = document.getElementById('settingsPanel');
            panel.classList.toggle('open');
        }

        function toggleVoiceInput() {
            if (chatApp.voiceRecognition) {
                chatApp.voiceRecognition.start();
            } else {
                alert('Voice recognition not supported in this browser');
            }
        }

        function attachFile() {
            const input = document.createElement('input');
            input.type = 'file';
            input.accept = '.txt,.json,.csv';
            input.onchange = (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (e) => {
                        const content = e.target.result;
                        const textarea = document.getElementById('messageInput');
                        textarea.value = `File: ${file.name}\n\n${content}`;
                        chatApp.updateSendButton();
                    };
                    reader.readAsText(file);
                }
            };
            input.click();
        }

        function toggleFullscreen() {
            if (!document.fullscreenElement) {
                document.documentElement.requestFullscreen();
            } else {
                document.exitFullscreen();
            }
        }

        function searchMessages() {
            const query = prompt('Search messages:');
            if (query) {
                const messages = document.querySelectorAll('.message-content');
                messages.forEach(msg => {
                    const text = msg.textContent.toLowerCase();
                    const highlight = text.includes(query.toLowerCase());
                    msg.style.backgroundColor = highlight ? 'rgba(255, 255, 0, 0.2)' : '';
                });
            }
        }

        function copyMessage(button) {
            const messageContent = button.closest('.message-content');
            const text = messageContent.textContent.replace('📋👍', '').trim();
            navigator.clipboard.writeText(text).then(() => {
                button.textContent = '✅';
                setTimeout(() => button.textContent = '📋', 2000);
            });
        }

        function likeMessage(button) {
            button.textContent = button.textContent === '👍' ? '❤️' : '👍';
        }

        function togglePipelineView() {
            const content = document.querySelector('.pipeline-content');
            content.style.display = content.style.display === 'none' ? 'block' : 'none';
        }

        // Error handling
        window.addEventListener('error', (e) => {
            console.error('Application error:', e.error);
            if (chatApp.processingActive) {
                chatApp.removeTypingIndicator();
                chatApp.addMessage('⚠️ An unexpected error occurred. Please refresh and try again.', false);
                chatApp.processingActive = false;
                document.getElementById('sendBtn').disabled = false;
                document.getElementById('sendBtn').innerHTML = '<span>Send</span><span>🚀</span>';
            }
        });

        // Service worker for offline functionality
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js').catch(console.error);
        }
    </script>
</body>
</html>
